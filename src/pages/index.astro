---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Selamat Menjalankan Ibadah Puasa ğŸŒ™">
  <!-- Background layers -->
  <div class="noise"></div>
  
  <!-- Stars -->
  <div class="stars-container" id="stars"></div>

  <!-- Horizon glow -->
  <div class="horizon-glow fixed inset-0 pointer-events-none z-0"></div>

  <!-- Main content -->
  <main class="relative z-10 min-h-screen flex flex-col items-center justify-between px-4 py-12">
    
    <!-- Top section: Lanterns -->
    <div class="w-full flex justify-between items-start px-6 md:px-16 opacity-0 animate-fade-in" style="animation-delay: 0.2s; animation-fill-mode: forwards;">
      <!-- Left lantern -->
      <div class="lantern animate-lantern-swing" style="animation-delay: 0s;">
        <svg width="48" height="80" viewBox="0 0 48 80" fill="none" xmlns="http://www.w3.org/2000/svg">
          <line x1="24" y1="0" x2="24" y2="12" stroke="#f5c842" stroke-width="2"/>
          <rect x="8" y="12" width="32" height="8" rx="4" fill="#d4960a"/>
          <path d="M6 20 L4 64 Q4 68 8 68 L40 68 Q44 68 44 64 L42 20 Z" fill="#e8a820" stroke="#f5c842" stroke-width="1"/>
          <rect x="10" y="20" width="28" height="44" rx="2" fill="rgba(255,220,80,0.15)" stroke="none"/>
          <line x1="6" y1="36" x2="42" y2="36" stroke="#d4960a" stroke-width="1" stroke-dasharray="3,3"/>
          <line x1="6" y1="52" x2="42" y2="52" stroke="#d4960a" stroke-width="1" stroke-dasharray="3,3"/>
          <ellipse cx="24" cy="42" rx="8" ry="10" fill="rgba(255,240,120,0.5)"/>
          <rect x="10" y="68" width="28" height="6" rx="3" fill="#d4960a"/>
          <ellipse cx="24" cy="42" rx="4" ry="5" fill="rgba(255,255,200,0.9)"/>
          <ellipse cx="24" cy="42" rx="20" ry="22" fill="rgba(245,200,66,0.08)"/>
        </svg>
      </div>

      <!-- Arabic text -->
      <div class="text-center opacity-70">
        <p class="font-arabic text-gold-300 text-2xl md:text-3xl" style="line-height: 1.8;">Ø±ÙÙ…ÙØ¶ÙØ§Ù†Ù Ø§Ù„Ù’Ù…ÙØ¨ÙØ§Ø±ÙÙƒ</p>
      </div>

      <!-- Right lantern -->
      <div class="lantern animate-lantern-swing" style="animation-delay: 0.5s;">
        <svg width="48" height="80" viewBox="0 0 48 80" fill="none" xmlns="http://www.w3.org/2000/svg">
          <line x1="24" y1="0" x2="24" y2="12" stroke="#f5c842" stroke-width="2"/>
          <rect x="8" y="12" width="32" height="8" rx="4" fill="#d4960a"/>
          <path d="M6 20 L4 64 Q4 68 8 68 L40 68 Q44 68 44 64 L42 20 Z" fill="#e8a820" stroke="#f5c842" stroke-width="1"/>
          <rect x="10" y="20" width="28" height="44" rx="2" fill="rgba(255,220,80,0.15)" stroke="none"/>
          <line x1="6" y1="36" x2="42" y2="36" stroke="#d4960a" stroke-width="1" stroke-dasharray="3,3"/>
          <line x1="6" y1="52" x2="42" y2="52" stroke="#d4960a" stroke-width="1" stroke-dasharray="3,3"/>
          <ellipse cx="24" cy="42" rx="8" ry="10" fill="rgba(255,240,120,0.5)"/>
          <rect x="10" y="68" width="28" height="6" rx="3" fill="#d4960a"/>
          <ellipse cx="24" cy="42" rx="4" ry="5" fill="rgba(255,255,200,0.9)"/>
          <ellipse cx="24" cy="42" rx="20" ry="22" fill="rgba(245,200,66,0.08)"/>
        </svg>
      </div>
    </div>

    <!-- Center section: Main greeting -->
    <div class="flex-1 flex flex-col items-center justify-center text-center max-w-3xl mx-auto gap-8">
      
      <!-- Moon + Stars icon -->
      <div class="opacity-0 animate-rise" style="animation-delay: 0.4s; animation-fill-mode: forwards;">
        <div class="relative inline-block">
          <div class="crescent animate-float"></div>
          <span class="absolute -top-3 -right-3 text-gold-300 text-lg animate-twinkle" style="animation-delay: 0.3s;">âœ¦</span>
          <span class="absolute -top-1 left-10 text-gold-200 text-sm animate-twinkle" style="animation-delay: 0.8s;">âœ¦</span>
          <span class="absolute top-8 -right-6 text-gold-300 text-xs animate-twinkle" style="animation-delay: 1.2s;">âœ¦</span>
        </div>
      </div>

      <!-- Hi greeting with name -->
      <div class="opacity-0 animate-rise" style="animation-delay: 0.6s; animation-fill-mode: forwards;">
        <p class="font-body text-senja-300 text-xl md:text-2xl tracking-widest uppercase mb-2">âœ¨ Assalamu'alaikum âœ¨</p>
        <div class="flex flex-col sm:flex-row items-center justify-center gap-3 mt-4">
          <span class="font-display text-gold-200 text-4xl md:text-5xl">Hi,</span>
          <span id="nameDisplay" class="font-display italic text-gold-300/50 text-3xl md:text-4xl">nama kamu... ğŸŒ™</span>
        </div>
      </div>

      <!-- Ornament -->
      <div class="ornament-line w-full max-w-xs opacity-0 animate-fade-in" style="animation-delay: 1s; animation-fill-mode: forwards;">
        <span class="text-gold-400 text-lg">âœ¦</span>
      </div>

      <!-- Main message -->
      <div class="opacity-0 animate-rise" style="animation-delay: 0.9s; animation-fill-mode: forwards; max-width: 600px;">
        <h1 class="shimmer-text font-display text-3xl md:text-5xl lg:text-6xl leading-tight mb-6">
          Selamat Menjalankan<br/>Ibadah Puasa
        </h1>
        <p class="font-body text-gold-100 text-lg md:text-xl italic leading-relaxed opacity-90">
          Semoga gift-nya barokah ya 
          <span class="not-italic">ğŸâœ¨</span>
        </p>
      </div>

      <!-- Ornament -->
      <div class="ornament-line w-full max-w-xs opacity-0 animate-fade-in" style="animation-delay: 1.2s; animation-fill-mode: forwards;">
        <span class="text-gold-400 text-lg">âœ¦</span>
      </div>

      <!-- Dua / sub message -->
      <div class="opacity-0 animate-rise" style="animation-delay: 1.1s; animation-fill-mode: forwards;">
        <p class="font-body text-senja-300 text-base md:text-lg leading-relaxed max-w-md">
          Semoga ibadah puasamu diterima Allah SWT, 
          <br/>dilimpahkan rahmat dan keberkahan di bulan suci ini ğŸ¤²
        </p>
      </div>

      <!-- Interactive emoji burst button -->
      <div class="opacity-0 animate-fade-in" style="animation-delay: 1.4s; animation-fill-mode: forwards;">
        <button 
          id="burstBtn"
          class="relative group mt-4 px-8 py-3 rounded-full border border-gold-400/40 bg-gold-400/10 text-gold-300 font-body text-base tracking-wide hover:bg-gold-400/20 hover:border-gold-400/70 transition-all duration-300 hover:scale-105 active:scale-95"
        >
          <span class="group-hover:hidden">Klik untuk doa ğŸŒ™</span>
          <span class="hidden group-hover:inline">Ramadan Mubarak! ğŸŠ</span>
        </button>
      </div>

    </div>

    <!-- Footer -->
    <footer class="opacity-0 animate-fade-in w-full text-center mt-12" style="animation-delay: 1.6s; animation-fill-mode: forwards;">
      <div class="ornament-line w-full max-w-sm mx-auto mb-4">
        <span class="text-gold-400/50 text-xs">âœ¦</span>
      </div>
      <p class="font-body text-gold-300/50 text-sm tracking-widest">
        made with <span class="text-senja-400 animate-pulse">â™¥</span> by 
        <span class="text-gold-300/80 italic">afghlm</span>
      </p>
      <p class="font-arabic text-gold-400/30 text-xs mt-2">Ø±Ù…Ø¶Ø§Ù† ÙƒØ±ÙŠÙ…</p>
    </footer>

  </main>

  <!-- Floating particles container -->
  <div id="particles" class="fixed inset-0 pointer-events-none z-0"></div>

  <!-- ===== Custom Alert Modal ===== -->
  <div id="nameAlertOverlay" class="fixed inset-0 z-50 items-center justify-center" style="display:none;">
    <!-- Backdrop blur -->
    <div id="alertBackdrop" class="absolute inset-0 bg-black/70 backdrop-blur-md"></div>

    <!-- Modal card -->
    <div
      id="alertCard"
      class="relative z-10 mx-4 w-full max-w-sm"
      style="opacity:0; transform:scale(0.85) translateY(24px); transition: opacity 0.4s cubic-bezier(.16,1,.3,1), transform 0.4s cubic-bezier(.16,1,.3,1);"
    >
      <!-- Outer glow border -->
      <div class="absolute -inset-[1px] rounded-2xl bg-gradient-to-br from-gold-400/70 via-senja-400/30 to-gold-400/70" style="filter:blur(1px);"></div>

      <div class="relative rounded-2xl overflow-hidden" style="background: linear-gradient(160deg, #15092e 0%, #1e1040 55%, #110827 100%);">
        <!-- Top shimmer bar -->
        <div class="h-[2px] w-full bg-gradient-to-r from-transparent via-gold-400 to-transparent"></div>

        <!-- Body -->
        <div class="px-8 py-9 flex flex-col items-center gap-5">

          <!-- Icon -->
          <div class="relative mb-1">
            <span class="text-5xl" style="display:inline-block; animation: float 5s ease-in-out infinite;">ğŸŒ™</span>
            <span class="absolute -top-2 -right-3 text-gold-300 text-base" style="animation: twinkle 2.5s ease-in-out infinite;">âœ¦</span>
            <span class="absolute -bottom-1 -left-3 text-gold-200 text-xs" style="animation: twinkle 3.2s ease-in-out infinite 0.7s;">âœ¦</span>
          </div>

          <!-- Title -->
          <div class="text-center">
            <p class="font-arabic text-gold-400/60 text-base mb-2" style="line-height:1.8;">Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…Ù°Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ’Ù…Ù</p>
            <h2 class="font-display text-gold-200 text-xl md:text-2xl">Siapa namamu?</h2>
            <p class="font-body text-gold-300/50 text-sm mt-1 italic">Perkenalkan dirimu dulu yuk âœ¨</p>
          </div>

          <!-- Input -->
          <div class="w-full relative">
            <input
              type="text"
              id="nameInput"
              class="name-input w-full font-display text-xl text-center"
              placeholder="nama kamu..."
              maxlength="20"
              autocomplete="off"
              spellcheck="false"
            />
            <div
              id="inputUnderline"
              class="absolute -bottom-1 left-1/2 -translate-x-1/2 h-[2px] bg-gold-400 rounded-full"
              style="width:0; transition: width 0.4s ease;"
            ></div>
          </div>

          <!-- Hint -->
          <p class="font-body text-gold-400/30 text-xs -mt-2 italic">Tekan Enter atau klik tombol di bawah</p>

          <!-- Buttons -->
          <div class="flex gap-3 w-full mt-1">
            <button
              id="alertCancel"
              class="flex-1 py-2.5 rounded-xl border border-gold-400/20 text-gold-400/50 font-body text-sm tracking-wide hover:border-gold-400/40 hover:text-gold-400/80 transition-all duration-200"
            >
              Lewati
            </button>
            <button
              id="alertConfirm"
              class="flex-[2] py-2.5 rounded-xl font-body text-sm font-semibold tracking-wide transition-all duration-200 hover:scale-105 active:scale-95"
              style="background: linear-gradient(135deg, #c8880a, #f5c842, #c8880a); color: #0a0614;"
            >
              Konfirmasi ğŸ‰
            </button>
          </div>

        </div>

        <!-- Bottom shimmer bar -->
        <div class="h-[2px] w-full bg-gradient-to-r from-transparent via-senja-400/50 to-transparent"></div>
      </div>
    </div>
  </div>

</Layout>

<script>
  // ===== Stars =====
  const starsContainer = document.getElementById('stars');
  for (let i = 0; i < 180; i++) {
    const star = document.createElement('div');
    star.classList.add('star');
    const size = Math.random() * 2.5 + 0.5;
    star.style.cssText = `
      width:${size}px; height:${size}px;
      top:${Math.random() * 85}%; left:${Math.random() * 100}%;
      opacity:${Math.random() * 0.7 + 0.2};
      animation: twinkle ${Math.random() * 4 + 2}s ease-in-out infinite;
      animation-delay:${Math.random() * 5}s;
    `;
    starsContainer?.appendChild(star);
  }

  // ===== Particles =====
  const particlesContainer = document.getElementById('particles');
  const emojis = ['ğŸŒ™', 'â­', 'âœ¨', 'ğŸ¤²', 'ğŸ', 'ğŸ’«', 'ğŸŒŸ', 'â˜ªï¸', 'ğŸ•Œ'];

  const fallStyle = document.createElement('style');
  fallStyle.textContent = `@keyframes fall {
    0%   { transform: translateY(0) rotate(0deg); opacity: 1; }
    80%  { opacity: 1; }
    100% { transform: translateY(110vh) rotate(360deg); opacity: 0; }
  }`;
  document.head.appendChild(fallStyle);

  function createParticle() {
    const el = document.createElement('div');
    el.style.cssText = `
      position:absolute;
      font-size:${Math.random() * 24 + 16}px;
      left:${Math.random() * 100}vw;
      top:-40px;
      pointer-events:none;
      animation: fall ${Math.random() * 3 + 2}s ease-in forwards;
      z-index:50;
    `;
    el.textContent = emojis[Math.floor(Math.random() * emojis.length)];
    return el;
  }

  // ===== Custom Alert =====
  const overlay        = document.getElementById('nameAlertOverlay') as HTMLDivElement;
  const alertCard      = document.getElementById('alertCard') as HTMLDivElement;
  const alertBackdrop  = document.getElementById('alertBackdrop') as HTMLDivElement;
  const nameInput      = document.getElementById('nameInput') as HTMLInputElement;
  const nameDisplay    = document.getElementById('nameDisplay') as HTMLSpanElement;
  const confirmBtn     = document.getElementById('alertConfirm') as HTMLButtonElement;
  const cancelBtn      = document.getElementById('alertCancel') as HTMLButtonElement;
  const inputUnderline = document.getElementById('inputUnderline') as HTMLDivElement;

  function openAlert() {
    overlay.style.display = 'flex';
    // Double rAF: waits for display:flex to apply before transitioning
    requestAnimationFrame(() => requestAnimationFrame(() => {
      alertCard.style.opacity = '1';
      alertCard.style.transform = 'scale(1) translateY(0)';
    }));
    setTimeout(() => nameInput.focus(), 420);
  }

  function closeAlert() {
    alertCard.style.opacity = '0';
    alertCard.style.transform = 'scale(0.9) translateY(16px)';
    setTimeout(() => { overlay.style.display = 'none'; }, 400);
  }

  function confirmName() {
    const name = nameInput.value.trim();
    if (!name) {
      nameInput.style.animation = 'none';
      void nameInput.offsetHeight; // force reflow
      nameInput.style.animation = 'shake 0.4s ease';
      nameInput.focus();
      return;
    }

    // Update the name display on main page
    nameDisplay.textContent = name;
    nameDisplay.style.fontStyle = 'normal';
    nameDisplay.style.color = '#fdeea0';
    nameDisplay.classList.remove('italic');

    document.title = `Selamat Puasa, ${name}! ğŸŒ™`;
    closeAlert();

    // Celebration emoji rain
    for (let i = 0; i < 20; i++) {
      setTimeout(() => {
        const p = createParticle();
        particlesContainer?.appendChild(p);
        setTimeout(() => p.remove(), 5000);
      }, i * 70);
    }
  }

  // â”€â”€ AUTO-OPEN on page load â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // 800ms delay lets the page entrance animations play first
  window.addEventListener('DOMContentLoaded', () => {
    setTimeout(openAlert, 800);
  });

  // â”€â”€ Event listeners â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  confirmBtn?.addEventListener('click', confirmName);
  cancelBtn?.addEventListener('click', closeAlert);
  alertBackdrop?.addEventListener('click', closeAlert);

  nameInput?.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') confirmName();
    if (e.key === 'Escape') closeAlert();
  });

  nameInput?.addEventListener('focus', () => { inputUnderline.style.width = '80%'; });
  nameInput?.addEventListener('blur',  () => { inputUnderline.style.width = '0'; });

  // ===== Burst Button =====
  document.getElementById('burstBtn')?.addEventListener('click', () => {
    for (let i = 0; i < 24; i++) {
      setTimeout(() => {
        const p = createParticle();
        particlesContainer?.appendChild(p);
        setTimeout(() => p.remove(), 5000);
      }, i * 60);
    }
  });

  // ===== Mouse parallax =====
  document.addEventListener('mousemove', (e) => {
    const x = (e.clientX / window.innerWidth - 0.5) * 16;
    const y = (e.clientY / window.innerHeight - 0.5) * 16;
    if (starsContainer) {
      starsContainer.style.transform = `translate(${x}px, ${y}px)`;
    }
  });
</script>

<style>
  @keyframes twinkle {
    0%, 100% { opacity: 0.2; transform: scale(0.8); }
    50%       { opacity: 1;   transform: scale(1.2); }
  }

  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    20%      { transform: translateX(-8px); }
    40%      { transform: translateX(8px); }
    60%      { transform: translateX(-5px); }
    80%      { transform: translateX(5px); }
  }

  input[type="text"].name-input {
    caret-color: #f5c842;
  }

  .crescent {
    filter:
      drop-shadow(0 0 25px rgba(245,200,66,0.9))
      drop-shadow(0 0 50px rgba(245,200,66,0.4));
  }

  /* Lock scroll when alert is visible */
  body:has(#nameAlertOverlay[style*="flex"]) {
    overflow: hidden;
  }
</style>